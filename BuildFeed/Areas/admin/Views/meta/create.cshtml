@model BuildFeed.Model.MetaItemModel
@{
   ViewBag.Title = $"Add metadata for {Model.Id.Value} | {InvariantTerms.SiteName}";
}

<h1>@($"Add metadata for {Model.Id.Value}")</h1>


@using (Html.BeginForm())
{
   @Html.AntiForgeryToken()

   @Html.HiddenFor(model => model.Id.Type)
   @Html.HiddenFor(model => model.Id.Value)

   <div class="form-group">
      @Html.LabelFor(model => model.MetaDescription)
      <div class="wide-group">
         @Html.TextAreaFor(model => model.MetaDescription, new
         {
            rows = "4"
         })
         <div>
            <span id="meta-count">0</span> characters
            @Html.ValidationMessageFor(model => model.MetaDescription)
         </div>
      </div>
   </div>

   <div class="form-group">
      @Html.LabelFor(model => model.PageContent)
      <div class="wide-group">
         @Html.TextAreaFor(model => model.PageContent)
         <div>
            @Html.ValidationMessageFor(model => model.PageContent)
         </div>
      </div>
   </div>

   <div class="form-group">
      <span class="label-placeholder"></span>
      <div>
         <input type="submit" value="Add metadata" />
      </div>
   </div>
}

@section Scripts
{
   <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" type="text/javascript"></script>
   <script src="~/Scripts/trumbowyg/trumbowyg.min.js" type="text/javascript"></script>
   <link href="~/Scripts/trumbowyg/ui/trumbowyg.min.css" rel="stylesheet" type="text/css" />

   <script src="~/Scripts/jquery.validate.js" type="text/javascript"></script>
   <script src="~/Scripts/jquery.validate.unobtrusive.min.js" type="text/javascript"></script>

   <script type="text/javascript">
      function updateMetaCount()
      {
         var count = document.getElementById("@Html.IdFor(model => model.MetaDescription)").value.length;
         $("#meta-count").text(count.toFixed(0));
         if (count === 0)
         {
            $("#meta-count").attr("class", "");
         }
         else if (count < 160)
         {
            $("#meta-count").attr("class", "text-success");
         }
         else
         {
            $("#meta-count").attr("class", "text-danger");
         }
      }

      $(function()
      {
         var btnsGrps = $.trumbowyg.btnsGrps;

         $("#@Html.IdFor(model => model.PageContent)")
            .trumbowyg({
               autogrow: true,
               btns: [
                  ['strong', 'em'],
                  '|', 'link',
                  '|', 'btnGrp-lists',
                  '|', 'btnGrp-justify',
                  '|', 'viewHTML',
                  '|'
               ]
            });

         $(".trumbowyg").addClass("trumbowyg-black");

         $("#@Html.IdFor(model => model.MetaDescription)")
            .keyup(function()
            {
               updateMetaCount();
            });

         updateMetaCount();
      });
   </script>
}